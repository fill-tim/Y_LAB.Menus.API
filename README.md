# Y_LAB.Menus.API


## Домашняя работа для интенсива Y_LAB UNIVERSITY

### Задание 1:

Написать проект на FastAPI с использованием PostgreSQL в качестве БД. В проекте следует реализовать REST API по работе с меню ресторана, все CRUD операции.
Для проверки задания, к презентаций будет приложена Postman коллекция с тестами. Задание выполнено, если все тесты проходят успешно.
Даны 3 сущности: Меню, Подменю, Блюдо.

## Зависимости:

● У меню есть подменю, которые к ней привязаны.

● У подменю есть блюда.

## Условия:

● Блюдо не может быть привязано напрямую к меню, минуя подменю.

● Блюдо не может находиться в 2-х подменю одновременно.

● Подменю не может находиться в 2-х меню одновременно.

● Если удалить меню, должны удалиться все подменю и блюда этого меню.

● Если удалить подменю, должны удалиться все блюда этого подменю.

● Цены блюд выводить с округлением до 2 знаков после запятой.

● Во время выдачи списка меню, для каждого меню добавлять кол-во подменю и блюд в этом меню.

● Во время выдачи списка подменю, для каждого подменю добавлять кол-во блюд в этом подменю.

● Во время запуска тестового сценария БД должна быть пуста.

### Задание 2:

● Обернуть программные компоненты в контейнеры. Контейнеры должны запускаться по одной команде “docker-compose up -d” или той которая описана вами в readme.md.

● Образы для Docker:

(API) python:3.10-slim

(DB) postgres:15.1-alpine


1.Написать CRUD тесты для ранее разработанного API с помощью библиотеки pytest

2.Подготовить отдельный контейнер для запуска тестов. Команду для запуска указать в README.md

3.* Реализовать вывод количества подменю и блюд для Меню через один (сложный) ORM запрос.

4.** Реализовать тестовый сценарий «Проверка кол-ва блюд и подменю в меню» из Postman с помощью pytest

Если FastAPI синхронное - тесты синхронные, Если асинхронное - тесты асинхронные

### Задание 3: 

1.Вынести бизнес логику и запросы в БД в отдельные слои приложения.

2.Добавить кэширование запросов к API с использованием Redis. Не забыть про инвалидацию кэша.

3.Добавить pre-commit хуки в проект. Файл yaml будет прикреплен к ДЗ.

4.Покрыть проект type hints (тайпхинтами)

5.* Описать ручки API в соответствий c OpenAPI

6.** Реализовать в тестах аналог Django reverse() для FastAPI

### Требования:

●Код должен проходить все линтеры.

●Код должен соответствовать принципам SOLID, DRY, KISS.

●Проект должен запускаться по одной команде (докер).

●Проект должен проходить все Postman тесты (коллекция с Вебинара №1).

●Тесты написанные вами после Вебинара №2, должны быть актуальны, запускать и успешно проходить

Дополнительно:
Контейнеры с проектом и с тестами запускаются разными командами.

## Для работы базы данных, создайте файл .env и пропишите там переменные из файла .env.example:
Примечание:

Необходимо в переменной POSTGRES_PORT, REDIS_EXTERNAL_PORT, TEST_REDIS_EXTERNAL_PORT указывать порт, который не занят на вашем компьютере.
Для проверки занят ли порт можно использовать в командной строке команду (на Windows):

	netstat -aon | findstr :<PORT>

## Для запуска проекта через docker-compose перейдите в директоию main и пропишите следующую команду:
	docker-compose up -d --build app

## Для запуска тестов через docker-compose перейдите в директоию main и пропишите следующую команду:
	docker-compose up --build tests

## После запуска приложения, перейдите в браузер для просмотра всех эндпоинтов и введите в url строке следующее:
	http://localhost:8000/docs

## Для просмотра запущенных контейнеров перейдите в директоию main и пропишите следующую команду:
	docker-compose ps

## Для остановки запущенных контейнеров перейдите в директоию main и пропишите следующую команду:
	docker-compose stop <Название SERVICE>
